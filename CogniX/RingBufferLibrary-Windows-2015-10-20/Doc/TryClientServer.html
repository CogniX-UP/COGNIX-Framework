<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
<title>Try Client/Server</title>
<style>
	h3 {color:green;}
	pre {
		background-color:lightgrey;
		border:1px solid grey;
		padding:10px;
		margin:30px;
	}	
</style>
</head>
<body lang="EN-US">

<p>June 15, 2015</p>

<h1>Try Client/Server</h1>

<h2>Contents</h2>
<ul>
	<li><a href="#server">Start a Server</a></li>
	<li><a href="#client">Start a Client</a></li>
	<ul>
		<li><a href="#android">Android Client</a></li>
		<li><a href="#same">Client and Server on Same Computer</a></li>
		<li><a href="#separate">Client and Server on Separate Computers</a></li>
	<li><a href="#develop">Develop a Program</a></li>
	</ul>
	<li><a href="#firewall">Firewall Considerations</a></li>
<ul>
	<li><a href="#win">For Windows 7</a></li>
	<li><a href="#linux">For CentOS 7 Linux</a></li>
	<li><a href="#osx">For OSX</a></li>
</ul>
	<li><a href="#test">Testing Internet Bandwidth</a></li>
</ul>

<a name="server"></a>
<h3>Start a Server</h3>

<p>When using the 2015 <em>RingBuffer</em> library, client and server
handling is performed entirely within the library.  Most acquisition
programs are not even aware of it.  This means that any program
using this library to access its Usb ring buffer
can function as a server application.</p>

<p>The client program has no control over the Usb acquisition process.
The <em>RingBuffer</em> library merely taps into the Usb ring buffer
to get samples to transmit to the client.
</p>

<p>Start a normal acquisition program on a Windows, Linux or OSX system.
For instance, any version of <em>ActiView</em>, <em>ActiView-Light</em>,
the 2015 version of <em>RingBuffer_SyncTest</em> or
anything else that uses the 2015 <em>RingBuffer</em> library.

<p>Whatever program is used, it must be paired with the 2015 version
of the <em>RingBuffer</em> library.  If the program has been using
a previous version of this library (or <em>Labview_DLL</em>), just replace
the library file with the newest version.  If necessary, copy and rename
the <em>RingBuffer</em> library to the <em>Labview_DLL</em> library name.</p>

<a name="client"></a>
<h3>Start a Client</h3>

<p>Try clients, in this order:
	<ul>
		<li><a href="#android">1. Android Client</a></li>
		<li><a href="#same">2. Client and Server on Same Computer</a></li>
		<li><a href="#separate">3. Client and Server on Separate Computers</a></li>
	</ul>

Note: Try only one of these client options at a time.  For bandwidth reasons,the
server will connect with only one client at a time.
</p>

<a name="android"></a>
<h4>1. Android Client</h4>

<p>The sample Android App included in this download, <em>BSChannel Viewer</em>, is a client application that can be used on either a tablet or smartphone.
Follow these steps:
<ul>
	<li>Install the App on the device.<br>
	<p>This can usually be done using a Usb cable to connect the mobile
	device to the computer with the <em>BSChannelViewer.apk</em> file.
	There are plenty of web sites that describe exactly how to do this or
	give other ways to do this on the various mobile devices.</p>
<li>Start the App.</li>
<br>
<li>Touch the gear icon in the upper right corner of the screen.</li>
<br>
<li>Enter and save the name or IP address of the system performing the Usb acquisition.  Any DNS or NetBios name or IPv4 address that works with "ping" should
work.
</li>
<br>
<li>On the App's main screen touch either the "32 channels" or "All channels" box to open
the connection to the Usb acquisition system.
<p>The choice consideration here is
only to reduce bandwidth required.  In either case, all channels are available
for display on the client.  In 32 channel mode, the App will transparently request different sets of
32 channels as needed rather than requesting all available channels from the start.
</p>
</li>
<li>More details on the use of this Android App are available here:
<a href="BSChannelViewer.html" target=_blank">BSChannelViewer</a>
</li>
</ul>
<p>If the connection fails, there may be a Firewall problem on the Windows/Linux/OSX
server system.  See the <a href="#firewall">Firewall Considerations</a> section below.</p>

<a name="same"></a>
<h4>2. Client and Server on Same Computer</h4>

<p>Start a second acquisition on the same computer.</p>

<p>If you use the National Instruments (NI) LabVIEW environment a second time (e.g. to run <em>ActiView</em> twice, in parallel)
there could be trouble.  This is a restriction
of the LabVIEW environment.  On Windows, simply coping the executable file
making a file to use with a different name seems to overcome the problem.</p>
<p>The 2015 version of the test program <em>RingBuffer_SyncTest</em> can be
used as a client to test the remote client feature.
</p>

<a name="separate"></a>
<h4>3. Client and Server on Separate Computers</h4>

<p>If running the client and server on the same computer works, try running
the client program instead on a second computer.</p>

<p>The second computer needs:
<ul>
	<li>An application program.</li>
	<li>The 2015 <em>RingBuffer</em> library.</li>
	<li>The 2015 <em>ringbuffer.ini</em> parameter file.</li>
</ul>
</p>
<p>The second computer could be any Windows, Linux or OSX system that can run
an acquisition program that uses the 2015 version of the <em>RingBuffer</em>
library.</p>
<p>The client computer doesn't need any Usb driver or Usb library because
samples will come from a socket.
Thus on Windows, there is no need to install the Microsoft Usb driver
"WinUsb" nor on Linux or OSX, the libusb-1.0 library.</p>

<p>Beware when using <em>ActiView</em> or <em>ActiView-Light</em> as a remote
client.
Both programs have watchdog timers that will abort the connection
attempt if the computers involved are slow at connecting.  And when
the network is heavily loaded, the current <em>ActiView</em> versions 
(705, 706, 707) and <em>ActiView-Light</em> (604)
can be sensitive to the extra delays caused by receiving samples
through the internet.
If <em>ActiView</em> or <em>ActiView-Light</em> is failing during the initial
connection attempt, adding a line to the client's <em>ringbuffer.ini</em>
file with just the word "sync" sometimes helps.
</p>
<p>A typical <em>ringbuffer.ini</em> parameter file is included in the
download and looks like this:
<pre>
# Comments start with #
#
#  connect_node
#
# Used by the client computer.
# The name or ip address of the computer whose ring buffer is
# being filled by the BioSemi receiver via usb.  This will be
# the sample stream TCP server.
# Any name or IPv4 address that works with ping should work.
# When multiple connect_node lines are given, the last is used.
# When no connect_node parameter is declared, the default is the
# loopback address 127.0.0.1.
# Remove the '#' to activate a parameter line.
# For example:
connect_node macbook-a3013c
connect_node 127.0.0.1		# loopback ip address
#
#  connect_port
#
# Used by the client computer.
# The port number to connect on the sample stream server computer.
# This must match the listen_port number in the sample stream
# server's parameter file.
# When multiple connect_port lines are given, the last is used.
# When no connect_port is declared, the default is 3113.
# Remove the '#' to activate a parameter line.
# For example:
connect_port 3113
#
#  listen_port
#
# Used by the server computer.
# The port number to listen on for client connection requests.
# This must match the connect_port number in the client's
# parameter file.
# When multiple listen_port lines are given, the last is used.
# When listen_port is set to 0, client connections are disabled.
# When no listen_port is declared, the default is 3113.
# Remove the '#' to activate a parameter line.
# For example:
listen_port 3113
</pre>

<p>The name or IP address of the acquisition server (i.e. the one whose
ring buffer is being filled from a Usb) must be set in the second computer's
(the client's) <em>ringbuffer.ini</em> parameter file, parameter
"connect_node".  Any DNS or NetBios name that works with "ping" should
work, or if necessary, the IPv4 address itself.
</p>

<p>Generally the <em>ringbuffer.ini</em> parameter file should be in the same
directory as the acquisition program being run.  The file can, instead, be in the user's
home directory - the library will look there if an .ini file is
not found in the program directory.
When running under
the control of the National Instruments LabVIEW Workbench, the
.ini file should be in the user's home directory because the NI
Workbench doesn't report to the vi's being run the directory from which
they come.
On Windows, the home directory is the concatination of the
environment variables HOMEDRIVE and HOMEPATH; on Linux and
OSX it is the environment variable HOME.</p>

<p>If the connection attempt itself fails, there may be a Firewall problem on
one or both of systems being used.  See the
<a href="#firewall">Firewall Considerations</a> section below.</p>

<a name="develop"></a>
<h3>Develop a Program</h3>

<p>To develop your own client or server program using the <em>RingBuffer</em> library,
see
<a href="RingBufferLibrary-API.html" target=_blank">RingBufferLibrary-API</a> for a description
of the API's available.</p>

<p>
To develop a client program without using the <em>RingBuffer</em> library
to receive samples (e.g. as a tablet or smartphone App), see
<a href="RingBufferLibrary-TransferProtocol.html" target=_blank">RingBufferLibrary-TransferProtocol</a> for a description of the Tcp transfer protocol used.
</p>


<a name="firewall"></a>
<h3>Firewall Considerations</h3>

<p>On most systems permission must be specifically granted for a program to
communicate through the local firewall.  The following are some things we found
of assistance in getting through firewalls.</p>

<a name="win"></a>
<h5>For Windows 7:</h5>

<p>The procedure is outlined at
<pre>
<a href="http://windows.microsoft.com/en-ca/windows/communicate-through-windows-firewall#1TC=windows-7">http://windows.microsoft.com/en-ca/windows/communicate-through-windows-firewall#1TC=windows-7</a>
</pre>
and/or
<pre>
<a href="http://windows.microsoft.com/en-ca/windows/open-port-windows-firewall#1TC=windows-7">http://windows.microsoft.com/en-ca/windows/open-port-windows-firewall#1TC=windows-7</a>
</pre>
</p>

<a name="linux"></a>
<h5>For CentOS 7 Linux:</h5>

<p>The procedure is outlined at
<pre>
<a href=
"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html</a>
</pre>
in section "4.5.14.1.6. Open Ports in the Firewall".</p>

<p>This is a command to determine if a particular port (here 3113) is open:

<pre>firewall-cmd --zone=public --query-port=3113/tcp</pre>

The output is either "yes" or "no".</p>

<a name="osx"></a>
<h5>For OSX:</h5>

<p>Official instructions are given here:
<pre>
<a href="https://support.apple.com/en-ca/HT201642">https://support.apple.com/en-ca/HT201642</a>
</pre>
</p>
<p>But perhaps the easiest way to get access through the firewall is to just run your program in
"server" mode, that is, with the Usb cable connected.  In this mode the program will attempt to
"listen" for a port connection from a client.
When this happens a system query appears that asks if this "listen" request should be
"Allowed" or "Denied".  If you select "Allow" this choise is remembered for future use
of this particular program.  Allowing "listen" requests seems to clear the way for the
program to also operate in "client" mode, i.e. making a "connect" request through the
firewall.
</p>

<a name="test"></a>
<h3>Testing Internet Bandwidth</h3>

<p>The sample Android App, <em>BSChannelViewer</em>, reports throughput per
channel per second and the number of re-syncs.
</p>

<p>Another way to test the speed of an internet connection is to use the 2015
<em>RingBuffer_SyncTest</em> as the client.  Each line printed by this program
shows the current throughput per channel per second and the number of times a
re-sync has occurred.</p>

<p>If re-syncs are occurring, the number of channels being
transferred can be reduced by specifying a sub channel range when starting
the program.  For example:
<pre>RingBuffer_SyncTest r35-66 0
</pre>
This creates a ring buffer on the client with space for all the channels
being sampled on the server, but only the sync, status and second set of 32
channels are filled.  The sync and status words are always transferred.
When the number of channels being transferred is reduced, the throughput per
channel and the number of re-syncs should show improvement.</p>

<p><em>BSChannelViewer</em> can request channels in a sliding group of
32 at a time.</p>

<p>The current <em>ActiView</em> versions (705, 706, 707) have no option to
request a reduced set of the available channels.</p>

<p>
Generally, wired connections are faster than wireless connections, even
if only one of the computers is using a wired connection.  And wired connections
usually give more consistent throughput.</p>

<p>
Another option is to skip the router altogether by setting up a direct 
computer-to-computer connection using an RJ45 Crossover ethernet cable.
This has been used successfully for client/server operation between
Windows 7 and OSX with locally assigned IP numbers.
Once the cable is connected use "Network Preferences" on OSX and "ipconfig"
on Windows to determine the self-assigned IP numbers and verify the
connection using "ping".  Then add the server's numbers into the client's
<em>ringbuffer.ini</em> file and run the programs as normal.
</p>
</body>
</html>
